{"version":3,"sources":["../../../../app/chapter/%5Bid%5D/page.tsx","../../../../node_modules/lucide-react/src/icons/arrow-right.ts","../../../../node_modules/lucide-react/src/icons/circle-check-big.ts","../../../../node_modules/lucide-react/src/icons/clock.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport api from '../../../utils/api';\r\nimport { useAuth } from '../../../context/AuthContext';\r\nimport { useRouter, useParams } from 'next/navigation';\r\nimport { Clock, CheckCircle, ArrowRight } from 'lucide-react';\r\nimport Link from 'next/link';\r\n\r\nexport default function ChapterView() {\r\n    const { user, loading } = useAuth();\r\n    const router = useRouter();\r\n    const params = useParams();\r\n    const [chapter, setChapter] = useState<any>(null);\r\n    const [timeLeft, setTimeLeft] = useState(180); // 3 minutes\r\n    const [timeSpent, setTimeSpent] = useState(0);\r\n    const [completed, setCompleted] = useState(false);\r\n    const [canComplete, setCanComplete] = useState(false);\r\n\r\n    const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n    const saveIntervalRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!loading && !user) router.push('/login');\r\n        if (user && params.id) {\r\n            fetchChapter();\r\n            // Also fetch progress to resume time/status?\r\n            // Basic requirement: Start timer regardless? Or check if completed.\r\n            // Let's check status first.\r\n        }\r\n        return () => {\r\n            if (timerRef.current) clearInterval(timerRef.current);\r\n            if (saveIntervalRef.current) clearInterval(saveIntervalRef.current);\r\n        }\r\n    }, [user, loading, params.id]);\r\n\r\n    const fetchChapter = async () => {\r\n        try {\r\n            const id = params.id;\r\n            const [chRes, progRes] = await Promise.all([\r\n                api.get(`/chapters/${id}`),\r\n                api.get('/progress')\r\n            ]);\r\n\r\n            setChapter(chRes.data);\r\n\r\n            const userProg = progRes.data.find((p: any) => p.chapterId === parseInt(id as string));\r\n            if (userProg) {\r\n                setCompleted(userProg.completed);\r\n                // Resume time functionality could be here if we tracked strictly.\r\n                // Requirement: \"Po wejściu do rozdziału... Start licznika... Po osiągnięciu 180 sekund... completed = true\"\r\n                // If already completed, no timer needed, or optional.\r\n                if (userProg.completed) {\r\n                    setCanComplete(true);\r\n                    setTimeLeft(0);\r\n                } else {\r\n                    // If not completed, we restart timer or calculate diff?\r\n                    // Let's restart timer for simplicity of \"spędzenia 3 minut w sesji\" or just total accumulated?\r\n                    // Requirement: \"Backend validuje czy faktycznie minęło min 180 sek\" (Total)\r\n                    // So we should see how much time they ALREADY spent.\r\n                    setTimeSpent(userProg.timeSpent);\r\n                    const remaining = Math.max(0, 180 - userProg.timeSpent);\r\n                    setTimeLeft(remaining);\r\n                    if (remaining === 0) setCanComplete(true);\r\n                    else startTimer();\r\n                }\r\n            } else {\r\n                startTimer();\r\n            }\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    };\r\n\r\n    const startTimer = () => {\r\n        // Local timer for UI countdown\r\n        timerRef.current = setInterval(() => {\r\n            setTimeLeft(prev => {\r\n                if (prev <= 1) {\r\n                    setCanComplete(true);\r\n                    if (timerRef.current) clearInterval(timerRef.current);\r\n                    return 0;\r\n                }\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n\r\n        // Backend sync every 10s\r\n        saveIntervalRef.current = setInterval(() => {\r\n            saveProgress(10);\r\n        }, 10000);\r\n    };\r\n\r\n    const saveProgress = async (increment: number) => {\r\n        try {\r\n            await api.post('/progress/update', {\r\n                chapterId: params.id,\r\n                timeIncrement: increment\r\n            });\r\n            // Verify total time?\r\n            // Backend returns { canComplete, completed }\r\n        } catch (err) {\r\n            console.error('Progress save fail', err);\r\n        }\r\n    };\r\n\r\n    const handleComplete = async () => {\r\n        try {\r\n            await api.post('/progress/complete', { chapterId: params.id });\r\n            setCompleted(true);\r\n            // Redirect to dashboard or load next?\r\n            router.push('/dashboard');\r\n        } catch (err) {\r\n            alert('Jeszcze nie minęło wystarczająco dużo czasu lub błąd serwera.');\r\n        }\r\n    };\r\n\r\n    if (!chapter) return <div>Ładowanie...</div>;\r\n\r\n    const formatTime = (seconds: number) => {\r\n        const m = Math.floor(seconds / 60);\r\n        const s = seconds % 60;\r\n        return `${m}:${s.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-4xl mx-auto space-y-8 pt-32 pb-20 px-6\">\r\n            <Link href=\"/dashboard\" className=\"text-amber-600 hover:text-amber-700 hover:underline font-medium inline-flex items-center\">\r\n                &larr; Powrót do kursu\r\n            </Link>\r\n\r\n            <div className=\"bg-white p-8 rounded-2xl shadow-lg border border-stone-200\">\r\n                <div className=\"flex justify-between items-center mb-6\">\r\n                    <h1 className=\"text-3xl font-bold text-slate-900\">{chapter.title}</h1>\r\n\r\n                    {!completed && (\r\n                        <div className={`flex items-center space-x-2 px-4 py-2 rounded-full font-mono text-lg shadow-sm\r\n                    ${canComplete ? 'bg-green-100 text-green-700 ring-1 ring-green-200' : 'bg-amber-100 text-amber-800 ring-1 ring-amber-200'}`}>\r\n                            <Clock className=\"h-5 w-5\" />\r\n                            <span>{canComplete ? 'Czas minął!' : formatTime(timeLeft)}</span>\r\n                        </div>\r\n                    )}\r\n                    {completed && (\r\n                        <div className=\"flex items-center space-x-2 px-4 py-2 bg-green-100 text-green-700 rounded-full ring-1 ring-green-200\">\r\n                            <CheckCircle className=\"h-5 w-5\" />\r\n                            <span>Ukończono</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {chapter.videoUrl && (\r\n                    <div className=\"aspect-video bg-slate-900 rounded-xl mb-6 overflow-hidden shadow-md\">\r\n                        {/* Simple embed detection or just link */}\r\n                        {chapter.videoUrl.includes('youtube') ? (\r\n                            <iframe\r\n                                src={chapter.videoUrl.replace('watch?v=', 'embed/')}\r\n                                className=\"w-full h-full\"\r\n                                allowFullScreen\r\n                                title=\"Video\"\r\n                            />\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-center h-full text-white\">\r\n                                <a href={chapter.videoUrl} target=\"_blank\" className=\"underline text-amber-400 hover:text-amber-300\">Zobacz video</a>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"prose prose-slate prose-headings:text-slate-900 max-w-none text-slate-700 mb-8 whitespace-pre-wrap leading-loose\">\r\n                    {chapter.content}\r\n                </div>\r\n\r\n                <div className=\"flex justify-end pt-6 border-t border-stone-100\">\r\n                    {completed ? (\r\n                        <button\r\n                            onClick={() => router.push('/dashboard')}\r\n                            className=\"px-6 py-3 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 font-bold transition-colors\"\r\n                        >\r\n                            Wróć do listy\r\n                        </button>\r\n                    ) : (\r\n                        <button\r\n                            onClick={handleComplete}\r\n                            disabled={!canComplete}\r\n                            className={`flex items-center space-x-2 px-8 py-3 rounded-lg font-bold transition-all\r\n                        ${canComplete ? 'bg-amber-600 text-white hover:bg-amber-700 shadow-lg transform hover:-translate-y-1' : 'bg-stone-200 text-stone-400 cursor-not-allowed'}`}\r\n                        >\r\n                            <span>Oznacz jako ukończone</span>\r\n                            <ArrowRight className=\"h-5 w-5\" />\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M5 12h14', key: '1ays0h' }],\n  ['path', { d: 'm12 5 7 7-7 7', key: 'xquz4c' }],\n];\n\n/**\n * @component @name ArrowRight\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNNSAxMmgxNCIgLz4KICA8cGF0aCBkPSJtMTIgNSA3IDctNyA3IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/arrow-right\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowRight = createLucideIcon('arrow-right', __iconNode);\n\nexport default ArrowRight;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M21.801 10A10 10 0 1 1 17 3.335', key: 'yps3ct' }],\n  ['path', { d: 'm9 11 3 3L22 4', key: '1pflzl' }],\n];\n\n/**\n * @component @name CircleCheckBig\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEuODAxIDEwQTEwIDEwIDAgMSAxIDE3IDMuMzM1IiAvPgogIDxwYXRoIGQ9Im05IDExIDMgM0wyMiA0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/circle-check-big\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CircleCheckBig = createLucideIcon('circle-check-big', __iconNode);\n\nexport default CircleCheckBig;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M12 6v6l4 2', key: 'mmk7yg' }],\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n];\n\n/**\n * @component @name Clock\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTIgNnY2bDQgMiIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/clock\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Clock = createLucideIcon('clock', __iconNode);\n\nexport default Clock;\n"],"names":[],"mappings":"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","ignoreList":[1,2,3]}